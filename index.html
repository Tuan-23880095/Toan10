<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đề Ôn Tập Toán 10 HK1 - CTST</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        body { font-family: 'Roboto', sans-serif; background-color: #f0fdf4; }
        
        /* Styles cho Kéo Thả */
        .drag-source { cursor: pointer; transition: all 0.2s; user-select: none; }
        .drag-source.selected { transform: scale(1.05); box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-weight: bold; background-color: #166534 !important; color: white !important; }
        .drop-target { border: 2px dashed #86efac; min-width: 100px; display: inline-block; padding: 2px 8px; border-radius: 4px; background: white; cursor: pointer; color: #14532d; font-weight: bold; margin: 0 4px; vertical-align: middle;}
        .drop-target.filled { border-style: solid; background-color: #dcfce7; border-color: #166534; }

        /* Loading */
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 50; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #16a34a; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <div class="max-w-5xl mx-auto p-4">
        <!-- Header -->
        <header class="bg-gradient-to-r from-green-700 to-emerald-800 text-white p-6 rounded-t-lg shadow-lg mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-center uppercase" id="appTitle">Ôn Tập Toán 10 Cuối Kỳ 1</h1>
            <p class="text-center mt-2 text-green-100 italic">Biên soạn theo chương trình Chân Trời Sáng Tạo</p>
        </header>

        <!-- Student Info -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6 border-l-4 border-green-600">
            <h2 class="text-lg font-bold mb-4 text-gray-800 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                Thông tin thí sinh
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Họ và tên</label>
                    <input type="text" id="studentName" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Nhập họ tên...">
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Lớp</label>
                    <input type="text" id="groupName" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Ví dụ: 10A1">
                </div>
            </div>
        </div>

        <!-- Main Form -->
        <form id="quizForm" class="space-y-8">
            
            <!-- PHẦN 1: TRẮC NGHIỆM -->
            <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-blue-500">
                <h2 class="text-xl font-bold mb-4 text-blue-700">PHẦN I: TRẮC NGHIỆM (12 Câu - 3.0 điểm)</h2>
                <div id="mcq-container" class="space-y-6">
                    <!-- JS will render MCQs here -->
                </div>
            </div>

            <!-- PHẦN 2: ĐÚNG SAI -->
            <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-orange-500">
                <h2 class="text-xl font-bold mb-4 text-orange-700">PHẦN II: ĐÚNG / SAI (4 Câu - 4.0 điểm)</h2>
                <div id="tf-container" class="space-y-8">
                    <!-- JS will render TF here -->
                </div>
            </div>

            <!-- PHẦN 3: ĐIỀN KHUYẾT (KÉO THẢ) -->
            <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-purple-500">
                <h2 class="text-xl font-bold mb-4 text-purple-700">PHẦN III: ĐIỀN KHUYẾT (5 Câu - 1.0 điểm)</h2>
                <p class="text-sm text-gray-600 mb-2 italic">Click chọn từ khóa rồi click vào ô trống để điền.</p>
                
                <div class="bg-purple-50 p-4 rounded-lg mb-6 sticky top-2 z-10 shadow-sm border border-purple-200">
                    <h3 class="font-bold text-purple-800 mb-2 text-sm uppercase">Ngân hàng từ khóa:</h3>
                    <div id="word-bank" class="flex flex-wrap gap-2">
                        <!-- JS renders words here -->
                    </div>
                </div>
                <div id="fill-container" class="space-y-4">
                    <!-- JS renders fill questions here -->
                </div>
            </div>

            <!-- PHẦN 4: TRẢ LỜI NGẮN -->
            <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-red-500">
                <h2 class="text-xl font-bold mb-4 text-red-700">PHẦN IV: TRẢ LỜI NGẮN (5 Câu - 2.0 điểm)</h2>
                <div id="sa-container" class="space-y-6">
                    <!-- JS renders SA questions here -->
                </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center pb-12 pt-6">
                <button type="button" onclick="submitExam()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 text-xl flex items-center justify-center mx-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    NỘP BÀI & XEM ĐIỂM
                </button>
            </div>
        </form>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="fixed inset-0 bg-gray-900 bg-opacity-60 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 md:p-8 max-w-md w-full shadow-2xl transform transition-all scale-100">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
                    <svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Kết Quả Bài Làm</h3>
                <p class="text-sm text-gray-500 mb-4">Dữ liệu đã được gửi về hệ thống.</p>
                
                <div class="bg-gray-50 p-4 rounded-lg text-left space-y-2 border border-gray-200">
                    <p class="flex justify-between"><span>Thí sinh:</span> <span id="resName" class="font-medium"></span></p>
                    <div class="border-t border-gray-300 my-2"></div>
                    <p class="flex justify-between text-lg"><strong>Tổng điểm:</strong> <span id="resTotal" class="text-red-600 font-bold"></span></p>
                    <div class="grid grid-cols-2 gap-2 text-sm mt-2">
                        <div class="bg-white p-2 rounded border border-blue-200">TN: <span id="resP1" class="font-bold text-blue-600"></span></div>
                        <div class="bg-white p-2 rounded border border-orange-200">Đ/S: <span id="resP2" class="font-bold text-orange-600"></span></div>
                        <div class="bg-white p-2 rounded border border-purple-200">Điền: <span id="resP3" class="font-bold text-purple-600"></span></div>
                        <div class="bg-white p-2 rounded border border-red-200">Ngắn: <span id="resP4" class="font-bold text-red-600"></span></div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button onclick="closeModal()" class="w-full rounded-lg border border-transparent shadow-sm px-4 py-3 bg-green-600 text-white font-medium hover:bg-green-700 transition">Đóng & Xem lại bài</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CẤU HÌNH ---
        // THAY URL BÊN DƯỚI BẰNG LINK APP SCRIPT CỦA BẠN
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwKeTMSqe5fDYbjPS5JkhAaiHkwWYGDoOkCmvQXxp5LkInboOgZt4S7lXh_40D7VEl8wg/exec"; 

        // --- DỮ LIỆU ĐỀ THI (Dựa trên PDF và yêu cầu) ---
        const examData = {
            mcq: [
                { q: "Cho tập hợp A = {x ∈ N | x ≤ 5}. Tập hợp A là:", options: ["{1;2;3;4;5}", "{0;1;2;3;4;5;6}", "{0;1;2;3;4;5}", "{1;2;3;4;5;6}"], ans: 2 },
                { q: "Tập xác định của hàm số y = √(x-2) là:", options: ["(2; +∞)", "[2; +∞)", "R \\ {2}", "(-∞; 2]"], ans: 1 },
                { q: "Parabol y = x² - 4x + 3 có trục đối xứng là:", options: ["x = -2", "x = 4", "x = 2", "x = -4"], ans: 2 },
                { q: "Cho tam giác ABC có AB=c, AC=b, BC=a. Định lý Cosin tại đỉnh A là:", options: ["a² = b² + c² + 2bc.cosA", "a² = b² + c² - 2bc.cosA", "a² = b² + c² - bc.cosA", "a² = b² - c² + 2bc.cosA"], ans: 1 },
                { q: "Cho vector a = (2; -3) và vector b = (1; 4). Tọa độ vector u = a + b là:", options: ["(3; 1)", "(1; -7)", "(3; -1)", "(-1; 7)"], ans: 0 },
                { q: "Số trung bình của mẫu số liệu: 4, 6, 8, 10, 12 là:", options: ["6", "8", "10", "7"], ans: 1 },
                { q: "Bất phương trình nào sau đây là BPT bậc nhất hai ẩn?", options: ["x² + y > 0", "x + 2y < 3", "xy + 5 ≥ 0", "1/x + y ≤ 1"], ans: 1 },
                { q: "Giá trị của cos(120°) bằng:", options: ["1/2", "-1/2", "√3/2", "-√3/2"], ans: 1 },
                { q: "Cho hình bình hành ABCD. Khẳng định nào đúng?", options: ["vectơ AB + AD = AC", "vectơ AB - AD = AC", "vectơ AB + AC = AD", "vectơ CB + CD = CA"], ans: 0 },
                { q: "Điểm nào sau đây thuộc miền nghiệm của hệ BPT {x - y > 0; x + y < 4}?", options: ["(1; 2)", "(3; 0)", "(0; 0)", "(2; 3)"], ans: 1 }, // (3-0>0, 3+0<4 -> Đúng)
                { q: "Tích vô hướng của hai vectơ a và b khác 0 bằng 0 khi nào?", options: ["Hai vectơ cùng phương", "Hai vectơ cùng hướng", "Hai vectơ ngược hướng", "Hai vectơ vuông góc"], ans: 3 },
                { q: "Quy tròn số 15.6753 đến hàng phần trăm được:", options: ["15.67", "15.68", "15.6", "15.7"], ans: 1 }
            ],
            tf: [
                {
                    q: "Một gia đình cần ít nhất 900g Protein và 400g Lipid. Thịt bò (80% Pro, 20% Lip, giá 400k/kg). Thịt lợn (60% Pro, 40% Lip, giá 200k/kg).",
                    subs: [
                        "Gọi x, y là số kg thịt bò, thịt lợn. Hàm chi phí là F = 400x + 200y.",
                        "Hệ điều kiện: 0.8x + 0.6y ≥ 0.9 và 0.2x + 0.4y ≥ 0.4 (cùng x,y≥0).",
                        "Điểm (0.6; 0.7) thuộc miền nghiệm của hệ bất phương trình.", // 0.48+0.42=0.9(Đ), 0.12+0.28=0.4(Đ) -> Đúng
                        "Chi phí thấp nhất để đảm bảo dinh dưỡng là 380 nghìn đồng." // Tại (0.6, 0.7): 240+140=380. Tại (0.3, 1.1): 120+220=340. 340 < 380. Sai.
                    ],
                    ans: [true, true, true, false]
                },
                {
                    q: "Cho hàm số y = ax² + bx + c có đồ thị như hình vẽ (Parabol bề lõm quay lên, cắt Ox tại 1 và 3, đỉnh tại x=2, y=-1).",
                    subs: [
                        "Hệ số a < 0.", // Sai, lõm lên a>0
                        "Hàm số đồng biến trên khoảng (2; +∞).", // Đúng
                        "Phương trình f(x) = 0 có 2 nghiệm phân biệt.", // Đúng (cắt tại 1 và 3)
                        "Giá trị nhỏ nhất của hàm số là 1." // Sai, là -1
                    ],
                    ans: [false, true, true, false]
                },
                {
                    q: "Cho tam giác ABC đều cạnh a.",
                    subs: [
                        "Độ dài vectơ AB bằng a.", // Đúng
                        "Góc giữa vectơ AB và AC là 120 độ.", // Sai, là 60 độ
                        "Tích vô hướng AB.AC = a²/2.", // a.a.cos60 = a^2/2. Đúng
                        "Độ dài vectơ AB + AC bằng a√3." // Đúng (đường chéo hình thoi)
                    ],
                    ans: [true, false, true, true]
                },
                {
                    q: "Thống kê điểm số: 6, 7, 7, 8, 9, 9, 9, 10, 10 (9 học sinh).",
                    subs: [
                        "Mốt của mẫu số liệu là 9.", // Đúng (xuất hiện 3 lần)
                        "Số trung bình là 8.33 (làm tròn 2 chữ số).", // (75/9 = 8.33). Đúng
                        "Trung vị là 8.", // Sắp xếp: 6,7,7,8,9,9,9,10,10. Số giữa là 9. Sai.
                        "Khoảng biến thiên là 4." // 10-6=4. Đúng
                    ],
                    ans: [true, true, false, true]
                }
            ],
            wordBank: ["độ lệch chuẩn", "vectơ đối", "trọng tâm", "tù", "cộng", "trừ", "parabol", "vuông góc"],
            fill: [
                { text: "Đồ thị của hàm số bậc hai là một đường cong liền nét gọi là [].", ans: "parabol" },
                { text: "Quy tắc ba điểm: Vectơ AB + Vectơ BC = Vectơ AC là quy tắc [].", ans: "cộng" },
                { text: "Nếu tam giác ABC có góc A > 90 độ thì góc A gọi là góc [].", ans: "tù" },
                { text: "Số đặc trưng đo độ phân tán, bằng căn bậc hai của phương sai là [].", ans: "độ lệch chuẩn" },
                { text: "Điểm G thỏa mãn vectơ GA + GB + GC = 0 được gọi là [] của tam giác.", ans: "trọng tâm" }
            ],
            sa: [
                { q: "Cho mẫu số liệu: 10, 12, 14, 16, 18. Tìm trung vị của mẫu.", ans: "14" },
                { q: "Tam giác ABC có a=5, c=8, góc B=60 độ. Tính độ dài cạnh b.", ans: "7" }, // b^2 = 25+64 - 2.5.8.0.5 = 89-40=49 -> b=7
                { q: "Một vật chịu hai lực vuông góc F1=3N, F2=4N. Hợp lực có độ lớn bao nhiêu N?", ans: "5" },
                { q: "Parabol y = x² - 2x - 3 cắt trục tung tại điểm có tung độ bằng bao nhiêu?", ans: "-3" },
                { q: "Cho hình vuông ABCD cạnh 2. Tính tích vô hướng vectơ AB nhân vectơ AC.", ans: "4" } // AB(2,0), AC(2,2). 2*2 + 0*2 = 4. Hoặc |AB|.|AC|.cos45 = 2.2can2.can2/2 = 4
            ]
        };

        // --- STATE & RENDER LOGIC ---
        let selectedWord = null;

        function renderExam() {
            // 1. MCQ
            const mcqContainer = document.getElementById("mcq-container");
            examData.mcq.forEach((item, idx) => {
                const div = document.createElement("div");
                div.className = "p-4 border border-blue-100 rounded bg-blue-50 hover:shadow-sm";
                div.innerHTML = `
                    <p class="font-semibold text-gray-800">Câu ${idx + 1}: ${item.q}</p>
                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2">
                        ${item.options.map((opt, i) => `
                            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-blue-100 transition">
                                <input type="radio" name="mcq_${idx}" value="${i}" class="form-radio text-blue-600 focus:ring-blue-500 h-5 w-5">
                                <span>${opt}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                mcqContainer.appendChild(div);
            });

            // 2. TF
            const tfContainer = document.getElementById("tf-container");
            examData.tf.forEach((item, idx) => {
                const div = document.createElement("div");
                div.className = "p-4 border border-orange-100 rounded bg-orange-50 hover:shadow-sm";
                div.innerHTML = `
                    <p class="font-semibold text-gray-800 mb-2">Câu ${idx + 1}: ${item.q}</p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left">
                            <thead class="bg-orange-100 text-xs uppercase font-semibold text-orange-800">
                                <tr>
                                    <th class="px-4 py-2">Mệnh đề</th>
                                    <th class="px-4 py-2 w-16 text-center">Đúng</th>
                                    <th class="px-4 py-2 w-16 text-center">Sai</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-orange-200">
                                ${item.subs.map((sub, i) => `
                                    <tr>
                                        <td class="px-4 py-2">${String.fromCharCode(97+i)}) ${sub}</td>
                                        <td class="px-4 py-2 text-center"><input type="radio" name="tf_${idx}_${i}" value="true" class="text-orange-600 focus:ring-orange-500 h-4 w-4"></td>
                                        <td class="px-4 py-2 text-center"><input type="radio" name="tf_${idx}_${i}" value="false" class="text-orange-600 focus:ring-orange-500 h-4 w-4"></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                tfContainer.appendChild(div);
            });

            // 3. FILL
            const wordBank = document.getElementById("word-bank");
            examData.wordBank.forEach(word => {
                const span = document.createElement("span");
                span.className = "drag-source bg-white border border-purple-300 text-purple-700 px-3 py-1 rounded shadow-sm text-sm font-medium hover:bg-purple-100";
                span.innerText = word;
                span.onclick = () => selectWord(span, word);
                wordBank.appendChild(span);
            });

            const fillContainer = document.getElementById("fill-container");
            examData.fill.forEach((item, idx) => {
                const div = document.createElement("div");
                div.className = "p-3 border-b border-purple-100 last:border-0";
                const html = item.text.replace("[]", `<span class="drop-target border-purple-300 text-purple-800" id="fill_${idx}" onclick="dropWord(this)">...</span>`);
                div.innerHTML = `<span class="font-bold text-purple-800 mr-2">${idx + 1}.</span> ${html}`;
                fillContainer.appendChild(div);
            });

            // 4. SA
            const saContainer = document.getElementById("sa-container");
            examData.sa.forEach((item, idx) => {
                const div = document.createElement("div");
                div.className = "p-4 border border-red-200 rounded bg-red-50";
                div.innerHTML = `
                    <p class="font-semibold text-gray-800 mb-2">Câu ${idx + 1}: ${item.q}</p>
                    <input type="text" id="sa_${idx}" class="w-full p-2 border border-red-300 rounded focus:outline-none focus:ring-2 focus:ring-red-500 bg-white" placeholder="Nhập kết quả số...">
                `;
                saContainer.appendChild(div);
            });
        }

        // Logic Kéo Thả
        function selectWord(el, word) {
            document.querySelectorAll('.drag-source').forEach(e => e.classList.remove('selected'));
            if (selectedWord === word) {
                selectedWord = null;
            } else {
                selectedWord = word;
                el.classList.add('selected');
            }
        }

        function dropWord(el) {
            if (selectedWord) {
                el.innerText = selectedWord;
                el.classList.add('filled');
                selectedWord = null;
                document.querySelectorAll('.drag-source').forEach(e => e.classList.remove('selected'));
            } else {
                el.innerText = "...";
                el.classList.remove('filled');
            }
        }

        // Chấm điểm & Gửi
        async function submitExam() {
            const studentName = document.getElementById("studentName").value.trim();
            const groupName = document.getElementById("groupName").value.trim();

            if (!studentName || !groupName) {
                alert("Vui lòng nhập Họ tên và Lớp trước khi nộp bài!");
                return;
            }

            if(!confirm("Bạn có chắc chắn muốn nộp bài?")) return;

            document.getElementById("loading").style.display = "flex";

            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            const answerLog = []; // Lưu trữ đáp án chi tiết

            // Chấm MCQ (0.25đ/câu)
            examData.mcq.forEach((item, idx) => {
                const selected = document.querySelector(`input[name="mcq_${idx}"]:checked`);
                let ansStr = "X";
                if (selected) {
                    const val = parseInt(selected.value);
                    ansStr = (val === item.ans) ? "Đ" : "S"; // Ghi nhận Đ/S thay vì A/B/C/D
                    if (val === item.ans) p1 += 0.25;
                }
                answerLog.push(ansStr);
            });

            // Chấm TF (0.25đ/ý đúng)
            examData.tf.forEach((item, idx) => {
                let questionResult = [];
                item.subs.forEach((sub, i) => {
                    const selected = document.querySelector(`input[name="tf_${idx}_${i}"]:checked`);
                    if (selected) {
                        const val = selected.value === "true";
                        const isCorrect = (val === item.ans[i]);
                        if (isCorrect) p2 += 0.25;
                        // Ghi nhận Đ (nếu làm đúng) hoặc S (nếu làm sai) cho từng ý
                        questionResult.push(String.fromCharCode(97+i) + ":" + (isCorrect ? "Đ" : "S"));
                    } else {
                        questionResult.push(String.fromCharCode(97+i) + ":X");
                    }
                });
                answerLog.push(questionResult.join(", "));
            });

            // Chấm Fill (0.2đ/câu)
            examData.fill.forEach((item, idx) => {
                const el = document.getElementById(`fill_${idx}`);
                const userText = el.innerText.trim();
                if (userText === "...") {
                     answerLog.push("X");
                } else {
                     answerLog.push(userText);
                     if (userText.toLowerCase() === item.ans.toLowerCase()) p3 += 0.2;
                }
            });

            // Chấm SA (0.4đ/câu)
            examData.sa.forEach((item, idx) => {
                const val = document.getElementById(`sa_${idx}`).value.trim();
                answerLog.push(val || "X");
                if (val && val.toLowerCase() === item.ans.toLowerCase()) p4 += 0.4;
            });

            const score = Math.round((p1 + p2 + p3 + p4) * 100) / 100;
            
            // Xây dựng chuỗi thông báo tổng điểm
            const appTitle = document.getElementById('appTitle').innerText;
            const scoreSummary = [
                `${score} / 10`,
                `TN: ${p1}/3.0`,
                `Đ/S: ${p2}/4.0`,
                `Điền: ${p3}/1.0`,
                `Ngắn: ${p4}/2.0`
            ];

            // Gộp thông tin tổng điểm và danh sách trả lời
            const finalScoresPayload = [...scoreSummary, ...answerLog];

            // Payload gửi đi
            const payload = {
                role: appTitle, // Gửi tiêu đề ứng dụng
                evaluator: studentName,
                groupName: groupName,
                week: "DE_MOI_CTST",
                scores: finalScoresPayload
            };

            try {
                // Gửi request
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // Hiển thị kết quả
                document.getElementById("loading").style.display = "none";
                document.getElementById("resName").innerText = studentName + " (" + groupName + ")";
                document.getElementById("resTotal").innerText = score + " / 10";
                
                document.getElementById("resP1").innerText = `${p1}/3.0`;
                document.getElementById("resP2").innerText = `${p2}/4.0`;
                document.getElementById("resP3").innerText = `${p3}/1.0`;
                document.getElementById("resP4").innerText = `${p4}/2.0`;

                document.getElementById("resultModal").classList.remove("hidden");
                document.getElementById("resultModal").classList.add("flex");

            } catch (error) {
                console.error(error);
                alert("Lỗi kết nối. Vui lòng chụp lại màn hình kết quả!");
                document.getElementById("loading").style.display = "none";
                // Vẫn hiện kết quả local
                document.getElementById("resultModal").classList.remove("hidden");
                document.getElementById("resultModal").classList.add("flex");
            }
        }

        function closeModal() {
            document.getElementById("resultModal").classList.add("hidden");
            document.getElementById("resultModal").classList.remove("flex");
        }

        // Init
        window.onload = function() {
            renderExam();
        }
    </script>
</body>
</html>
